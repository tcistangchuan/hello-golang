- mvcc 实现原理

  ```
  多版本并发控制(Multi-Version Concurrency Control, MVCC)是MySQL中基于乐观锁理论实现隔离级别的方式，用于实现不可重复读和可重复读取隔离级别的实现。
  
  在MySQL中，会在表中每一条数据后面添加三个字段：最后创建的事务ID（DB_ROW_ID）,最后修改的事务ID（DB_TRX_ID），回滚指针（DB_ROLL_PTR）
    (1)INSERT: insert时将当前的事务ID赋值给最后创建的事务ID。
    (2)UPDATE: 保存当前事务ID到当前行的最后修改的事务ID，同时插入一条新纪录，保存当前事务ID为新纪录的最后创建的事务ID，实际上这里的更新是通过delete和insert实现的。
    (3)DELETE: 删除时将当前的事务ID赋值给最后修改的事务ID
    (4)SELECT: select时读取数据的规则为,最后创建的事务ID<=当前事务ID，并且最后修改的事务ID字段为空或>当前事务ID
  
  SLECET操作：
  	不可重复读隔离级别：每次select都生成一个快照读（ReadView）
  	可重复读隔离级别：开启事务后第一个select语句才生成是快照读(readView)，而不是一开启事务就快照读。
  
  update、insert、delete 操作：
  	当你执行这几个操作的时候默认会执行当前读，也就是会读取最新的记录，也就是别的事务提交的数据你也可以看到。
  ```

- 快照读实现方式：（实现可重复读）

  ```
  	快照读的实现方式：MVCC 和 undolog.
  ```

- 当前读的实现方式：（解决幻读）

  ```
  	当前读使用next-key锁(行锁+Gap间隙锁)实现,对读取的范围记录加锁，阻塞其他事务同时改动相同记录，避免出现安全问题。
  	在insert into test(xid) values (1), (3), (5), (8), (11);后，由于xid上是有索引的，该算法总是会去锁住索引记录。现在，该索引可能被锁住的范围如下：(-∞, 1], (1, 3], (3, 5], (5, 8], (8, 11], (11, +∞)。Session A（select * from test where id = 8 for update）执行后会锁住的范围：(5, 8], (8, 11]。除了锁住8所在的范围，还会锁住下一个范围，所谓Next-Key。
  ```

  

- redolog,undolog,binlog

  ```
  1.redo log(重做日志)
  	在事务的执行过程中，便开始写入redo log,记录的是物理数据页面的修改的信息,当对应事务的脏页写入到磁盘之后，redo log就会释放。
  作用：
  	（1）确保事务的持久性。
  	（2）防止在发生故障的时间点，尚有脏页未写入磁盘，在重启mysql服务的时候，根据redo log进行重做，从而达到事务的持久性这一特性。
  　
  2.undoLog(回滚日志) 
  	undo log主要分为两种：即insert undo log 和 update undo log。表示的是事务对insert新记录产生的undo log，只在事务回滚时需要，并且在事务提交后就可以立即丢弃。update undo log，事务对记录进行delete或者update操作时产生的undo log，不仅在事务回滚时需要，快照读也需要，所以不能随便删除，只有当数据库所使用的快照中不涉及该日志记录，对应的回滚日志才会被线程删除。
  作用：
  	（1）保存了事务发生之前的数据，可以用于回滚，保证事务的一致性;
  	（2）同时可以提供多版本并发控制下的快照读（MVCC）。
  
  3.binlog(二进制日志)
  	　事务提交的时候，一次性将事务中的sql语句（一个事物可能对应多个sql语句）按照一定的格式记录到binlog中。
  作用：
  	（1）用于复制，在主从复制中，从库利用主库上的binlog进行重演，实现主从同步。
  　（2）用于数据库的基于时间点的还原。
  	
  ```

- binlog和redolog的区别:

  ```
  1.redolog是在InnoDB存储引擎层产生，而binlog是MySQL数据库的上层服务层产生的。
  2.两种日志记录的内容形式不同。MySQL的binlog是逻辑日志，其记录是对应的SQL语句，对应的事务。而innodb存储引擎层面的重做日志是物理日志，是关于每个页（Page）的更改的物理情况。
  3.两种日志与记录写入磁盘的时间点不同，binlog日志只在事务提交完成后进行一次写入。而innodb存储引擎的重做日志在事务进行中不断地被写入，并日志不是随事务提交的顺序进行写入的。
  4.binlog不是循环使用，在写满或者重启之后，会生成新的binlog文件，redolog是循环使用。
  5.binlog可以作为恢复数据使用，主从复制搭建，redolog作为异常宕机或者介质故障后的数据恢复使用。
  ```

- Mysql如何保证一致性和持久性

  ```
  MySQL为了保证ACID中的一致性和持久性，使用了WAL(Write-Ahead Logging,先写日志再写磁盘)。Redo log就是一种WAL的应用。当数据库忽然掉电，再重新启动时，MySQL可以通过Redo log还原数据。也就是说，每次事务提交时，不用同步刷新磁盘数据文件，只需要同步刷新Redo log就足够了。undolog支持回滚保证了一致性。
  ```

- 

  